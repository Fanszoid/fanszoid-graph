type Event @entity {
  id: ID!
  tickets: [Ticket!] @derivedFrom(field: "event")
  ticketBalances: [TicketBalance!]! @derivedFrom(field: "event")
  sentTickets: [Transfer!] @derivedFrom(field: "event")
  metadata: String!
  organizer: User!
}

type Ticket @entity {
  id: ID!
  event: Event
  creatorRoyalty: Int!
  isResellable: Boolean!
  metadata: String!
  totalAmount: Int!
  ticketBalances: [TicketBalance!]! @derivedFrom(field: "ticket")
  sentTickets: [Transfer!] @derivedFrom(field: "ticket")
}

type TicketBalance @entity {
  id: ID!
  ticket: Ticket!
  event: Event
  askingPrice: BigInt
  amountOnSell: Int!
  amountOwned: Int!
  owner: User!
  isEventOwner: Boolean!
  sentTickets: [Transfer!] @derivedFrom(field: "senderBalance")
  receivedTickets: [Transfer!] @derivedFrom(field: "receiverBalance")
}

type User @entity {
  id: ID! # ETH addr
  address: Bytes!
  events: [Event!] @derivedFrom(field: "organizer")
  ticketBalances: [TicketBalance!] @derivedFrom(field: "owner")
  sentTickets: [Transfer!] @derivedFrom(field: "sender")
  receivedTickets: [Transfer!] @derivedFrom(field: "receiver")
}

type Transfer @entity {
  id: ID!
  event: Event!
  ticket: Ticket!
  sender: User!
  senderBalance: TicketBalance!
  receiver: User!
  receiverBalance: TicketBalance!
  price: BigInt!
  amount: Int!
  isSale: Boolean!
}

